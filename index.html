<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dropbox Sheet Preview</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  body { font-family: sans-serif; padding: 20px; }
  .file-item { margin-bottom: 25px; }
  button { margin-right: 10px; }
  iframe { width: 100%; height: 400px; border: 1px solid #ccc; display: none; margin-top: 10px; }
</style>
</head>
<body>

<h2>Dropbox Files from Sheet</h2>
<div id="fileList">Loading...</div>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS4LebC36zQ_LbyRlp5qw3EOiwAx5FBR5gdyst-qNVwjQL1d9DOP6KI5qZ4r-9vrn6Hg09s4LLukTyx/pub?gid=0&single=true&output=csv";

fetch(sheetURL)
  .then(res => res.text())
  .then(csvText => {
    const data = Papa.parse(csvText, { header: true }).data;
    const container = document.getElementById("fileList");

    if(!data || data.length === 0){
      container.innerText = "No files found.";
      return;
    }

    container.innerHTML = data.map((item, index) => {
      if(!item.url) return "";

      // Tambahkan ?dl=1 untuk download
      const downloadURL = item.url.replace(/(\?dl=0|$)/, '?dl=1');

      // Pakai Google Docs Viewer untuk preview
      const previewURL = `https://docs.google.com/gview?url=${encodeURIComponent(downloadURL)}&embedded=true`;

      return `
        <div class="file-item">
          <strong>File ${index + 1}</strong><br>
          <button onclick="togglePreview('iframe-${index}')">Preview</button>
          <button onclick="window.open('${downloadURL}', '_blank')">Download</button>
          <iframe id="iframe-${index}" src="${previewURL}"></iframe>
        </div>
      `;
    }).join("");
  })
  .catch(err => {
    console.error(err);
    document.getElementById("fileList").innerText = "Failed to load files.";
  });

function togglePreview(id){
  const iframe = document.getElementById(id);
  iframe.style.display = iframe.style.display === "block" ? "none" : "block";
}
</script>

</body>
</html>
